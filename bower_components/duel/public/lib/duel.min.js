/*!
 * DuelJS JavaScript Library v1.2.2
 * https://github.com/studentIvan/dueljs
 * http://dueljs.readthedocs.org/en/latest/
 *
 * Copyright 2014 Maslov Ivan
 * Released under the MIT license
 * https://raw.githubusercontent.com/studentIvan/dueljs/master/LICENSE
 */

duel={},duel.useStorageEvent=!/trident|MSIE/i.test(navigator.userAgent),duel.isLocalStorageAvailable=function(){try{return"localStorage"in window&&null!==window.localStorage&&void 0!==window.localStorage}catch(e){return!1}},duel.clone=function(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Object){t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=duel.clone(e[n]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")},duel.DuelAbstractChannel=function(){var e=function(){};return e.prototype.getName=function(){return this._name},e.prototype.setCurrentWindowAsMaster=function(){return!0},e.prototype.currentWindowIsMaster=function(){return!0},e.prototype.broadcast=function(e){this.currentWindowIsMaster()&&this.executeTrigger({name:e,args:Array.prototype.slice.call(arguments,1)})},e.prototype.emit=function(e){this.broadcast(e)},e.prototype.executeTrigger=function(e,t){if(t=t||!1,!(e instanceof Object))throw"triggerDetails should be an Object";if(!this.currentWindowIsMaster()||t)try{this._triggers[e.name]instanceof Array?(this._triggers[e.name][0].apply(this,e.args),delete this._triggers[e.name]):this._triggers[e.name].apply(this,e.args)}catch(n){}},e.prototype.on=function(e,t){this._triggers||(this._triggers={}),this._triggers[e]=t},e.prototype.once=function(e,t){this.on(e,[t])},e.prototype.off=function(e){try{delete this._triggers[e]}catch(t){}},e}(),duel._generateWindowID=function(){return this._windowID=+Math.random().toString().split(".")[1],this._windowID},duel.getWindowID=function(){return this._windowID?this._windowID:this._generateWindowID()},duel.DuelLocalStorageChannel=function(e){this._name=e,this.setCurrentWindowAsMaster()},duel.DuelLocalStorageChannel.prototype=duel.clone(duel.DuelAbstractChannel.prototype),duel.DuelLocalStorageChannel.prototype.setCurrentWindowAsMaster=function(){var e,t,n,r,a=duel.getWindowID(),l="dueljs_channel_"+this.getName();if(n=localStorage.getItem(l)){for(n=JSON.parse(n),r=-1,e=0,t=n.length;t>e;e++)n[e].master=!1,n[e].id===a&&(r=e);-1===r?n.push({id:a,master:!0}):n[r].master=!0,localStorage.setItem(l,JSON.stringify(n))}else localStorage.setItem(l,JSON.stringify([{id:a,master:!0}]));return!0},duel.DuelLocalStorageChannel.prototype.currentWindowIsMaster=function(){var e,t,n,r,a=duel.getWindowID(),l="dueljs_channel_"+this.getName();if(n=localStorage.getItem(l)){for(n=JSON.parse(n),r=-1,e=0,t=n.length;t>e;e++)if(n[e].id===a){r=e;break}return-1===r?!1:n[r].master}return!1},duel.DuelLocalStorageChannel.prototype.broadcast=function(e){this.currentWindowIsMaster()&&(localStorage.setItem("dueljs_trigger",JSON.stringify({channelName:this.getName(),triggerDetails:{name:e,args:Array.prototype.slice.call(arguments,1)}})),localStorage.setItem("dueljs_trigger_event_key",+Math.random().toString().split(".")[1]))},duel.DuelFakeChannel=function(e){this._name=e,console.error("DuelJS warning: instanceof DuelFakeChannel was created, check the localStorage support in your browser")},duel.DuelFakeChannel.prototype=duel.clone(duel.DuelAbstractChannel.prototype),duel.activeChannels=[],duel.channel=function(e){for(var t in duel.activeChannels)if(duel.activeChannels.hasOwnProperty(t)&&duel.activeChannels[t].getName()==e)return duel.activeChannels[t];var n=this.isLocalStorageAvailable()?new this.DuelLocalStorageChannel(e):new this.DuelFakeChannel(e);return duel.activeChannels.push(n),n},duel.makeCurrentWindowMaster=function(){for(var e=duel.activeChannels.length-1;e>=0;e--)try{duel.activeChannels[e].setCurrentWindowAsMaster()}catch(t){}},window.onfocus=function(){duel.makeCurrentWindowMaster()},window.isMaster=function(){return duel.activeChannels.length?duel.activeChannels[0].currentWindowIsMaster():!0},duel.addEvent=function(){return document.addEventListener?function(e,t,n){if(e&&e.nodeName||e===window)e.addEventListener(t,n,!1);else if(e&&e.length)for(var r=0;r<e.length;r++)addEvent(e[r],t,n)}:function(e,t,n){if(e&&e.nodeName||e===window)e.attachEvent("on"+t,function(){return n.call(e,window.event)});else if(e&&e.length)for(var r=0;r<e.length;r++)addEvent(e[r],t,n)}}(),duel.addEvent(window,"visibilitychange",function(){document.hidden||duel.makeCurrentWindowMaster()}),duel.storageEvent=function(e){if("dueljs_trigger"==e.key)for(var t=JSON.parse(e.newValue),n=duel.activeChannels.length-1;n>=0;n--)try{duel.activeChannels[n].getName()==t.channelName&&duel.activeChannels[n].executeTrigger(t.triggerDetails)}catch(r){}},duel.isLocalStorageAvailable()&&(duel.storageOldTriggerValue=localStorage.getItem("dueljs_trigger_event_key"),duel.useStorageEvent?duel.addEvent(window,"storage",function(e){var t=e||t||window.event;"dueljs_trigger_event_key"==t.key&&t.newValue!=duel.storageOldTriggerValue&&(duel.storageOldTriggerValue=localStorage.getItem("dueljs_trigger_event_key"),duel.storageEvent({key:"dueljs_trigger",newValue:localStorage.getItem("dueljs_trigger")}))}):setInterval(function(){localStorage.getItem("dueljs_trigger_event_key")!=duel.storageOldTriggerValue&&(duel.storageOldTriggerValue=localStorage.getItem("dueljs_trigger_event_key"),duel.storageEvent({key:"dueljs_trigger",newValue:localStorage.getItem("dueljs_trigger")}))},100),duel.addEvent(window,"unload",function(){var e,t,n,r,a,l,o=duel.getWindowID();for(n=duel.activeChannels.length-1;n>=0;n--)try{if(a="dueljs_channel_"+duel.activeChannels[n].getName(),e=localStorage.getItem(a))for(e=JSON.parse(e),l=-1,r=0,t=e.length;t>r;r++)if(e[r].id===o){e[r].master&&(e[r].master=!1,e[0].master=!0),e.splice(r,1),localStorage.setItem(a,JSON.stringify(e));break}}catch(i){}}));